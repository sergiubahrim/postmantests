{
	"info": {
		"_postman_id": "cd19cf69-5167-403d-93bc-f16fda6dc89a",
		"name": "TaxService blueprint",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "call to dispatch service better scheme with valid test",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "c838363a-ea9f-47a1-a350-d692913acea3",
						"exec": [
							"var schema = {",
							"    \"$schema\": \"http://json-schema.org/draft-06/schema#\",",
							"    \"$ref\": \"#/definitions/CallToDispatchService\",",
							"    \"description\": \"Calculated taxes for use inside Tradeshift.\",",
							"    \"definitions\": {",
							"        \"CallToDispatchService\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": true,",
							"            \"properties\": {",
							"                \"TaxResponse\": {",
							"                    \"$ref\": \"#/definitions/TaxResponse\"",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"TaxResponse\"",
							"            ],",
							"            \"title\": \"CallToDispatchService\"",
							"        },",
							"        \"TaxResponse\": {",
							"            \"type\": \"object\",",
							"            \"description\":\"Calculated taxes for use inside Tradeshift.\",",
							"            \"additionalProperties\": true,",
							"            \"properties\": {",
							"                \"TaxResponseVersion\": {",
							"                    \"type\": \"string\",",
							"                    \"description\": \"Version of the TaxResponse format\"",
							"                },",
							"                \"IsSuccess\": {",
							"                    \"type\": \"boolean\"",
							"                },",
							"                \"IsPartialSuccess\": {",
							"                    \"type\": \"boolean\"",
							"                },",
							"                \"IsAudited\": {",
							"                    \"type\": \"boolean\"",
							"                },",
							"                \"DocumentId\": {",
							"                    \"type\": \"string\"",
							"                },",
							"                \"DocumentNumber\": {",
							"                    \"type\": \"string\"",
							"                },",
							"                \"DocumentType\": {",
							"                    \"type\": \"string\"",
							"                },",
							"                \"CompanyId\": {",
							"                    \"type\": \"string\",",
							"                },",
							"                \"CurrencyCode\": {",
							"                    \"type\": \"string\"",
							"                },",
							"                \"CurrencyName\": {",
							"                    \"type\": \"string\"",
							"                },",
							"                \"TaxCalculationDate\": {",
							"                    \"type\": \"string\",",
							"                },",
							"                \"lines\": {",
							"                    \"type\": \"array\",",
							"                    \"items\": {",
							"                        \"$ref\": \"#/definitions/Line\"",
							"                    }",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"TaxResponseVersion\",",
							"                \"IsSuccess\",",
							"                \"IsPartialSuccess\",",
							"                \"IsAudited\",",
							"                \"DocumentId\",",
							"                \"DocumentNumber\",",
							"                \"DocumentType\",",
							"                \"CompanyId\",",
							"                \"CurrencyCode\",",
							"                \"CurrencyName\",",
							"                \"TaxCalculationDate\",",
							"                \"lines\"",
							"            ],",
							"            \"title\": \"TaxResponse\"",
							"        },",
							"        \"Line\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": false,",
							"            \"properties\": {",
							"                \"CodingLineId\": {",
							"                    \"type\": \"string\"",
							"                },",
							"                \"DocumentLineId\": {",
							"                    \"type\": \"string\"",
							"                },",
							"                \"Taxes\": {",
							"                    \"type\": \"array\",",
							"                    \"items\": {",
							"                        \"$ref\": \"#/definitions/TaxSubtotal\"",
							"                    }",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"CodingLineId\",",
							"                \"DocumentLineId\",",
							"                \"Taxes\"",
							"            ],",
							"            \"title\": \"Line\"",
							"        },",
							"        \"TaxSubtotal\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": true,",
							"            \"properties\": {",
							"                \"TaxableAmount\": {",
							"                    \"$ref\": \"#/definitions/TaxableAmount\"",
							"                },",
							"                \"TaxAmount\": {",
							"                    \"$ref\": \"#/definitions/TaxAmount\"",
							"                },",
							"                \"ClassifiedTaxCategory\": {",
							"                    \"$ref\": \"#/definitions/ClassifiedTaxCategory\"",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"TaxableAmount\",",
							"                \"TaxAmount\",",
							"                \"ClassifiedTaxCategory\"",
							"            ],",
							"            \"title\": \"TaxSubtotal\"",
							"        },",
							"        \"TaxableAmount\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": false,",
							"            \"properties\": {",
							"                \"value\": {",
							"                    \"type\":\"\" //need to be decided",
							"                },",
							"                \"currencyID\": {",
							"                    \"type\": \"\"  //need to be decided",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"value\",",
							"                \"currencyID\"",
							"            ],",
							"            \"title\": \"TaxableAmount\"",
							"        },",
							"         \"TaxAmount\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": false,",
							"            \"properties\": {",
							"                \"value\": {",
							"                    \"type\":\"\" //need to be decided",
							"                },",
							"                \"currencyID\": {",
							"                    \"type\": \"\"  //need to be decided",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"value\",",
							"                \"currencyID\"",
							"            ],",
							"            \"title\": \"TaxAmount\"",
							"        },",
							"        \"ClassifiedTaxCategory\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": false,",
							"            \"properties\": {",
							"                \"ID\": {",
							"                    \"$ref\": \"#/definitions/ID\"",
							"                },",
							"                \"Name\": {",
							"                    \"$ref\": \"#/definitions/Name\"",
							"                },",
							"                \"Percent\": {",
							"                    \"$ref\": \"#/definitions/Percent\"",
							"                },",
							"                \"TaxScheme\": {",
							"                    \"$ref\": \"#/definitions/TaxScheme\"",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"ID\",",
							"                \"Name\",",
							"                \"Percent\",",
							"                \"TaxScheme\"",
							"            ],",
							"            \"title\": \"ClassifiedTaxCategory\"",
							"        },",
							"        \"ID\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": true,",
							"            \"properties\": {",
							"                \"value\": {",
							"                    \"type\": \"string\",",
							"                    \"description\": \"A selection from the UN/ECE 5305 codeset version D08B https://www.unece.org/trade/untdid/d08b/tred/tred5305.htm\"",
							"                },",
							"                \"schemeID\": {",
							"                    \"type\": \"string\",",
							"                    \"enum\": [\"UN/ECE 5305\",",
							"                             \"UN/ECE 5153 Subset\"",
							"                             ]      ",
							"                },",
							"                \"schemeAgencyID\": {",
							"                    \"type\": \"string\",",
							"                    \"enum\":['6'],",
							"                },",
							"                \"schemeVersionID\": {",
							"                    \"type\": \"string\",",
							"                    \"enum\": [\"D08B\"]         ",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"value\",",
							"                \"schemeID\",",
							"                \"schemeAgencyID\",",
							"                \"schemeVersionID\"",
							"            ],",
							"            \"title\": \"ID\"",
							"        },",
							"        \"Name\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": false,",
							"            \"properties\": {",
							"                \"value\": {",
							"                    \"type\": \"string\"",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"value\"",
							"            ],",
							"            \"title\": \"Name\"",
							"        },",
							"        \"Percent\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": true,",
							"            \"properties\": {",
							"                \"value\": {",
							"                    \"type\": \"string\"",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"value\"",
							"            ],",
							"            \"title\": \"Percent\"",
							"        },",
							"        \"TaxScheme\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": false,",
							"            \"properties\": {",
							"                \"ID\": {",
							"                    \"$ref\": \"#/definitions/ID\"",
							"                },",
							"                \"Name\": {",
							"                    \"$ref\": \"#/definitions/Name\"",
							"                },",
							"                \"TaxTypeCode\": {",
							"                    \"$ref\": \"#/definitions/TaxTypeCode\"",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"ID\",",
							"                \"Name\",",
							"                \"TaxTypeCode\"",
							"            ],",
							"            \"title\": \"TaxScheme\"",
							"        },",
							"        \"TaxTypeCode\": {",
							"            \"type\": \"object\",",
							"            \"additionalProperties\": false,",
							"            \"description\": \"Tax type code for use by the customer's ERP system\",",
							"            \"properties\": {",
							"                \"value\": {",
							"                    \"type\": \"string\"",
							"                }",
							"            },",
							"            \"required\": [",
							"                \"value\"",
							"            ],",
							"            \"title\": \"TaxTypeCode\"",
							"        },",
							"    }",
							"}",
							"",
							"",
							"//Check response code",
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							" ",
							"//Check response time",
							"pm.test(\"Response time is less than 1200ms\", function () {",
							"    pm.expect(pm.response.responseTime).to.be.below(1200);",
							"});",
							" ",
							"//Validate Schema",
							"var jsonData = JSON.parse(responseBody);",
							"var result = tv4.validateMultiple(jsonData, schema);",
							"",
							"if (result.valid){",
							"    pm.test(\"JSON Response has valid schema\"), setTestStatus;",
							"",
							"} else {",
							"    for (var i = 0; i < result.errors.length; i++) {",
							"        pm.test('JSON Response is INVALID ' + result.errors[i].dataPath +\" \" + result.errors[i].message, setTestStatus);",
							"",
							"    }",
							"",
							"}",
							"",
							"function setTestStatus() {",
							"    pm.expect(result.valid).to.be.true;",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"auth": {
					"type": "oauth1",
					"oauth1": [
						{
							"key": "tokenSecret",
							"value": "{{token_secret}}",
							"type": "string"
						},
						{
							"key": "token",
							"value": "{{token}}",
							"type": "string"
						},
						{
							"key": "addParamsToHeader",
							"value": true,
							"type": "boolean"
						},
						{
							"key": "consumerSecret",
							"value": "OwnAccount",
							"type": "string"
						},
						{
							"key": "consumerKey",
							"value": "OwnAccount",
							"type": "string"
						},
						{
							"key": "signatureMethod",
							"value": "HMAC-SHA1",
							"type": "string"
						},
						{
							"key": "version",
							"value": "1.0",
							"type": "string"
						},
						{
							"key": "addEmptyParamsToSign",
							"value": false,
							"type": "boolean"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Content-Type",
						"type": "text",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"type": "text",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "https://api-market.eu-west-1.test.ts.sv/tradeshift/rest/external/tax-service/taxes/v1/{{DOCUMENT_ID}}?tenant={{tenant}}&actor={{actor}}",
					"protocol": "https",
					"host": [
						"api-market",
						"eu-west-1",
						"test",
						"ts",
						"sv"
					],
					"path": [
						"tradeshift",
						"rest",
						"external",
						"tax-service",
						"taxes",
						"v1",
						"{{DOCUMENT_ID}}"
					],
					"query": [
						{
							"key": "tenant",
							"value": "{{tenant}}"
						},
						{
							"key": "actor",
							"value": "{{actor}}"
						}
					]
				}
			},
			"response": []
		}
	],
	"auth": {
		"type": "oauth1",
		"oauth1": [
			{
				"key": "timestamp",
				"value": "",
				"type": "string"
			},
			{
				"key": "consumerKey",
				"value": "OwnAccount",
				"type": "string"
			},
			{
				"key": "consumerSecret",
				"value": "OwnAccount",
				"type": "string"
			},
			{
				"key": "token",
				"value": "{{token}}",
				"type": "string"
			},
			{
				"key": "tokenSecret",
				"value": "{{token_secret}}",
				"type": "string"
			},
			{
				"key": "signatureMethod",
				"value": "HMAC-SHA1",
				"type": "string"
			},
			{
				"key": "nonce",
				"value": "NqAwsTo1eWb",
				"type": "string"
			},
			{
				"key": "version",
				"value": "1.0",
				"type": "string"
			},
			{
				"key": "realm",
				"value": "",
				"type": "string"
			},
			{
				"key": "addParamsToHeader",
				"value": true,
				"type": "boolean"
			},
			{
				"key": "autoAddParam",
				"type": "any"
			},
			{
				"key": "addEmptyParamsToSign",
				"value": false,
				"type": "boolean"
			}
		]
	},
	"protocolProfileBehavior": {}
}